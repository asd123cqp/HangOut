<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css"">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/custom.css"">
  <title>HangOut</title>
</head>
<body>

  <!--==================== Navbar ====================-->
  <nav class="navbar sticky-top navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="index.html">HangOut</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor03" aria-controls="navbarColor03" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarColor03">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="index.html">
            <span class="fa fa-home"></span> Home <span class="sr-only">(current)</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="add_activity.html">
            <span class="fa fa-plus"></span> Create Activity
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="my_activities_attend.html">
            <span class="fa fa-comment"></span> My Activities
          </a>
        </li>
      </ul>

      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a id="show-username" class="nav-link" href="user.html">
            <span class="fa fa-user"></span> Sign in
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" onclick="logout()">
            <span class="fa fa-sign-out"></span> Sign out
          </a>
        </li>
      </ul>

    </div>
  </nav>
  <!--==================== Navbar ====================-->

  <!--==================== Content ====================-->
  <div class="container" style="width:100%;padding-top:5%">
    <div class="row">
      <div class="col-sm-8 col-md-6 col-lg-6 col-lg-offset-1">
        <img src="staticfiles/img/0.jpg" class="img-responsive img-rounded">
      </div>

      <div class="col-sm-9 col-md-6 col-lg-4" style="border:2px solid skyblue">

         <form id="user_login" class="form-horizontal" role="form" style="padding-top:5%" action="/login/" method="post">
          <div class="form-group">
             <label for="email" class="col-sm-2 control-label">Account</label>
             <div class="col-sm-10">
              <input id="username" type="text" class="form-control" id="email" name="account"
               placeholder="Email" value="">
             </div>
          </div>
          <div class="form-group">
             <label for="password" class="col-sm-2 control-label">Password</label>
             <div class="col-sm-10">
              <input id="password" type="password" class="form-control" id="password" name="password"
               placeholder="Password" value="">
             </div>
          </div>
        </form>
       <div class="col-sm-offset-1 col-sm-10">
        <a href="register.html">Register</a>
        <a href="#">Forgot Password?</a>
        <input type="submit" class="btn btn-success btn-lg" value="Login" onclick="Login()">
       </div>
      </div>
    </div>
  </div>
  <!--==================== Content ====================-->

  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/script.js"></script>
  <script>
    function Login() {
      $('input[type="submit"]').attr('disabled', true);
      var info = {
        username: $("#username").val(),
        password: $("#password").val(),
      };
      localStorage.setItem('hangout_account', $("#username").val());

      console.log(JSON.stringify(info));

      $.ajax({
        url: 'https://w217imcezl.execute-api.us-east-1.amazonaws.com/test/login',
        type: 'post',
        dataType: 'json',
        contentType: "application/json",
        success: function (data) {
          //alert(data.msg);
          console.log(data);
          $('input[type="submit"]').attr('disabled', false);
          if (data.Error) {
            if (data.Error == 'UserNotFoundException') {
            alert('User not found');
            return;
            }
            if (data.Error == 'NotAuthorizedException') {
            alert('Incorrect account or password');
            return;
            }
            if (data.Error == 'TooManyRequestsException') {
            alert('Operation too frequently');
            return;
            }
            alert('Other errors');
            return;
          }

          var user = data.user.AuthenticationResult;
          var res = data.res;
          localStorage.setItem('hangout_accesstoken', user.AccessToken);
          localStorage.setItem('hangout_idtoken', user.IdToken);
          localStorage.setItem('hangout_refreshtoken', user.RefreshToken);
          localStorage.setItem('hangout_id', res.id);
          console.log('done');
          location.href = 'all_activities_new.html';
        },
        data: JSON.stringify(info),
      });
    }
  </script>
</body>
</html>
